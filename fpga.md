<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax:{inlineMath:[['\$','\$'],['\\(','\\)']],processEscapes:true},CommonHTML: {matchFontHeight:false}});</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

# FPGA競技について

## 更新情報 ![更新](images/update.PNG)
- 2025-04-25 初版を公開しました

## FPGA 競技の基本方針
- FPGA 競技は **2024年度からスタートした新しい競技** です。以前は配置配線問題を模した「ナンバーリンク」の解を自動で求めるシステムや数値関数の値を求める演算器など、アルゴリズムやアーキテクチャの設計を行うコンテストを行って参りました。昨年度からコンテストの趣向を変えて、**プログラミング競技** と **FPGA競技** の2本立てになりました。コンテストの目的としてアルゴリズムデザインの方向性は変わりませんが、ソフトウェアだけでなく、**ハードウェアの分野においても** 論文投稿ができるように裾野を広げています。
- FPGA 競技についてはこれまでの応募件数も少なく、競技として習熟していないことから、昨年と同様、競技の大枠のみを設定し、一律の動作環境や実装条件などは定めない方向です。競技的な一律指標での優劣よりもむしろ、<ins>実装手法やアイディアの新規性、独創性など多彩な視点における「アルゴリズムデザイン」を提案</ins>していただき、論文投稿へ繋げていく場としてご活用いただければと思います。
- このような背景から、パフォーマンスも自己申告制としたいと思います。当日はライトニングトークもありますので、アピールポイントなど自由に発表していただければと思います。
- 実装のきっかけをつかんでいただけるように、**一案としての実装仕様** を以下に定めていますので、ご参考になさって下さい。
- プログラミング競技と FPGA 競技は **同じテーマ** を扱っています。昨年度は「ナンバープレイス・パズル（ナンプレ）」でしたが、今年度のテーマは「**マインスイーパー**」です。
- 事務局側からは参考程度の位置付けとして **マインスイーパーシステム・モジュールのサンプル** を提供させていただきます。**使用は必須ではありません** ので、自由にハードウェアを設計していただければと思います。

## 競技概要
- 「**マインスイーパー**」の問題を自動的に解く **ハードウェア（ソルバ）** を設計して下さい。
- Verilog-HDL 等を用いて開発いただき、可能であれば FPGA ボード等で動作させて下さい。
- FPGA への実装が難しい場合は論理シミュレーションや合成結果のみでも構いません。
- FPGA ボード等の環境は参加者ご自身でご用意いただければと思います。
- 「マインスイーパー」の基本ルールは **プログラミング競技と同一** です。ただし、**盤面の表現の仕方** や **データ構造** 、**セル値の表現** 等はハードウェアに合わせて自由に変えて下さい。また、地雷をオープンした場合の扱いやスコアのカウント方法もプログラミング競技とは異なります。[ルールと得点](#ルールと得点) をご参照下さい。
 
## ハードウェアの入力
- **盤面データ** が入力となります。プログラミング競技で使用する盤面データと同じフォーマットのテキストファイルです。
- ホストPCとFPGA間で通信を行い、盤面データのテキストファイルをFPGAに送り込む等の方法により、動作中のFPGAに問題を与えます。
- FPGA へのデータ送信が難しい場合は、盤面データをFPGA内のROMに予め書き込んでおいても構いません。
- 論理シミュレーションの場合はシミュレータに合わせて盤面データを入力してください。

## ハードウェアの出力
- ホストPCとFPGA間で通信を行い、最終盤面のテキストファイルをホストPCに送り出す等の方法により、ホストPC上で解答データを取得します。
- 実機での動作確認が難しい場合は、論理シミュレータを用いてRAMに格納される解答データを取得しても構いません。
- 上記以外の方法による解答データの取得も可能です。

## ルールと得点
- 提供予定のマインスイーパーシステム・モジュールでは **地雷以外の全てのセルをオープンした場合** に終了となります。
- 終了した盤面における、オープンした **(1) 地雷セルの数**、**(2) セル選択に要したクロックサイクル数**、**(3) 研究の新規性、有効性、ポスター完成度** などを元にパフォーマンスを評価します。

## 競技用盤面データの提供について
- FPGA 競技で使用する盤面データはまだご提供できておりません。
- 準備ができましたらこちらのサイトで開示いたしますので、更新情報をご覧いただければと思います。
- サンプルの盤面データは **マインスイーパーシステム・モジュールのサンプル** に含まれていますので、ご参考になさってください。サンプルプログラム (testbench.v) では以下のファイルを読み込みます。
  - board_size.txt ... 盤面サイズ情報
  - board.txt ........ 盤面データ
```
board_size.txt
3 5
```
```
board.txt
0F 02 01 01 01
01 02 0F 02 01
00 01 01 02 0F
```
- サンプルプログラムの board モジュールは以下のポートを持っています。
```
module board (
    input wire clk,
    input wire reset,
    input wire [3:0] row,   // 行
    input wire [3:0] col,   // 列
    input wire select,      // マス選択
    output reg [7:0] board_state, // セルの状態
    output reg [2047:0] current_board // ボードの状態
);
```
- ボードデータの各セルは下記のように設計されています。各セルは 8-bit で構成されており、上位4ビットはセルがオープンされたかどうかの判定に使用しています。また、下位4ビットは周囲の地雷の数を保持しています。
```
  - board_state[7:5] : Reserved（未使用）
  - board_state[4]   : セルのオープン情報 (0x0 で未オープン、0x1 でオープン)
  - board_state[3:0] : 周囲の地雷の数(0x0 - 0x8), 地雷(0xF)
```
- オープンされていない地雷セルは 0x0F となります。
- オープンされた地雷セルは 0x1F となります。
- オープンされた状態のセルは 0x10 から 0x18 となります。
- マインスイーパーシステム・モジュールでは全てのセルの値が 0x0F、0x10 から 0x18、0x1F のいずれかになっていれば終了となります。

<!--
## 9x9のデータフォーマット
- 出題問題は0-9の数値が9x9の配列のテキストファイルで提示されます。
- 出題問題において、9x9の各セルに0-9の数値が代入されており、1-9の場合は固定数値、0はナンプレ問題の空欄を意味します。
- この値をどのようにハードウェア内部に格納するかは回答者が自由に設定できます

## 評価の方法
- 使用した回路リソース、動作周波数と所用サイクル数を報告して頂き、これと使用したFPGAの基本性能を勘案して、回路規模や性能を評価します。また、アルゴリズム的な工夫も勘案して、総合的に評価します。
- 事前に数問(5～10問)提供する予定です。
- 投稿の際に参加者自身で所要サイクル数の事前計測をお願いします。
- 入出力でホストPCと通信を行う際にかかるサイクル数は計測から除外します。

## サンプル・テストベンチ
- [model.tar.gz](model.tar.gz)からダウンロードしてください。
- ナンプレを解くための Verilog プログラムとして作成したサンプル・テストベンチを提供します。ソルバは含めておりません。
- このテストベンチの使用は必須ではありません。ソルバ開発においてご使用いただいても構いません。
- サンプル・テストベンチは model.tar.gzからダウンロードしてください。
- ソースファイルについて
  - TOP_MODEL.v： 最上位のwrapper
  - test_top_model.v：TOP_MODELの実体。中でBOARD.vなどを呼び出す。
  - BOARD.v：board構造体。内部に9x9(x4bit)の数値を格納した状態で開始する。
  - GETEMPTY.v：参考構造体。BOARD上に空(value=0)の位置を探し、その座標を返す。
  - BOARDCHECK.v：参考構造体。Board上に{val,raw,col}を代入した場合、ナンバープレースの条件を満たしているかを確認する。
- ソルバの実装方法
  - 参加者が開発したソルバ・モジュールは test_top_model.v に加筆し、入出力を BOARD インスタンスと結線して下さい。
- サイクル数の計測方法
    - 自分の良いタイミングで、BOARDにアクセス開始してください。
    - アクセス開始時にP_CONFIG_ONGOINGを0→1にしてください。終了時に1→0に落としてください。
    - 1になっている区間のサイクル数を計測します。
    - 現在のBOARD構造体は1マスずつアクセスしております。このアクセス方法について改造はOKです。
- dataフォーマット
  - NUM - 値、該当座標に登録されている数値を示す  
  0 : 未登録を示す。例えばリセット直後は明示的にこの値である。 (利用参照可能)  
  1-9 : その座標の値は該当数値に登録されている(利用参照可能)  
  10-15 : エラー。(利用不可、参照不可)
  - ROW, COL - 座標を示す。  
  0 : 未登録を示す 。リセット直後の値であったり、座標回答Failを意味する(利用参照可能)  
  1-9 : その座標の値を示す(利用可能、参照可能)  
  10-15 : 利用不可能、エラー
      
## 提出方法
- コンテストに参加される方は「DAシンポジウム2024参加申込」と「ADC参加申し込み」を7/26(金)までに行って下さい。
  - コンテスト参加者はDAシンポジウム当日にポスターセッションで発表頂くため、「DAシンポジウム2024参加申込」が必須です。
  - 評価用の問題の配布やポスターセッションの詳細のご連絡などは、「ADC参加申し込み」をされた方にお送りいたします。
- 作品の提出方法は以下の通りです。
  - 作品の提出は、das”at”sig-sldm.org 宛のメールでお願いします（”at”は@に変換してください）。
  - メール本文には、「ADC参加申し込み」に記載いただいたお名前もしくはチーム名を明記してください。
  - 作品の提出締切は 2024年8月21日(水) です。
- FPGA競技に関してご不明な点や各種ご相談を承ります（連絡先はコチラへ、nakmura”at”jp.fujitsu.com）

-->
